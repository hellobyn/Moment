/********************************************************************************************************
** 
**                               			北京交通大学                                     
**
**-------------------------------------------------------------------------------------------------------
** 	文件名：		Delay.c
** 	创建时间：		2014-1-6	10:15
** 	创建人员： 		赵秉贤
** 	文件描述:  		延时函数源文件
** 
**-------------------------------------------------------------------------------------------------------
** 	最后修改时间：	2014-1-6	10:15 
** 	最后修改人员：	赵秉贤	
** 	版本号： 	   	V1.0
** 	版本描述： 		延时函数源文件
**
*********************************************************************************************************/

#include "Delay.h"

/*********************************************************************************************************
**	变量定义
*********************************************************************************************************/

static u8  facus=0;													 	/*	us延时倍乘数			*/
static u16 facms=0;														/*	ms延时倍乘数			*/

/*********************************************************************************************************
**	函数原型:	DelayInit(u8 SYSCLK)
**	函数功能:	延时函数初始化
**	输入参数:	u8 SYSCLK 系统时钟
**	输出参数:	无
**	返回参数:	无
**	修改时间:	2014-1-6	9:35
*********************************************************************************************************/
void DelayInit(u8 SYSCLK)
{
	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK_Div8);					/*	选择外部时钟作为系统时钟*/
	facus=SYSCLK/8;		    										   	/*	us延时倍乘数 = HCLK/8	*/
	facms=(u16)facus*1000;												/*	ms延时倍乘数 = us×1000	*/
}

/*********************************************************************************************************
**	函数原型:	void delayus(u32 nus)
**	函数功能:	延时函数（微秒）	
**	输入参数:	u32 nus 延时微秒数
**	输出参数:	无
**	返回参数:	无
**	修改时间:	2014-1-6	9:35
*********************************************************************************************************/
void Delayus(u32 nus)
{		
	u32 temp;	    	 
	SysTick->LOAD=nus*facus; 												/*	延时时间加载			*/	  		 
	SysTick->VAL=0x00;        												/*	清空计数器				*/
	SysTick->CTRL=0x01 ;      				 								/*	开始倒数计时 			*/
	do
	{
		temp=SysTick->CTRL;
	}
	while(temp&0x01&&!(temp&(1<<16)));	   									/* 	等待时间到达			*/
	SysTick->CTRL=0x00;       												/*	关闭计数器 				*/
	SysTick->VAL =0X00;       	 											/*	清空计数器				*/
}

/*********************************************************************************************************
**	函数原型:	void delayms(u16 nms)
**	函数功能:	延时函数（毫秒）
**	输入参数:	u16 nms 延时毫秒数
**	输出参数:	无
**	返回参数:	无
**	备注事项:	72M主频条件下,nms<=1864
**	修改时间:	2014-1-6	9:35
*********************************************************************************************************/
void Delayms(u16 nms)
{	 		  	  
	u32 temp;		   
	SysTick->LOAD=(u32)nms*facms;											/*	延时时间加载			*/
	SysTick->VAL =0x00;           											/*	清空计数器				*/
	SysTick->CTRL=0x01 ;          			  								/*	开始倒数计时 			*/
	do
	{
		temp=SysTick->CTRL;
	}
	while(temp&0x01&&!(temp&(1<<16)));				   					   	/* 	等待时间到达			*/
	SysTick->CTRL=0x00;      												/*	关闭计数器 				*/
	SysTick->VAL =0X00;       				  	    						/*	清空计数器				*/
}

